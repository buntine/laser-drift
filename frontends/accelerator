#! /usr/bin/env python

import time
import curses

CONTENT = "  %s  "
MAX_SPEED = 15

def init_gradient():
    gradient = [48, 47, 82, 118, 154, 190, 220, 208, 202, 196, 160, 124, 88, 88, 52, 52]

    for i, c in enumerate(gradient):
        curses.init_pair(i + 1, 232, c)

def set_background(stdscr):
    curses.init_pair(17, 0, 236)
    stdscr.bkgdset(" ", curses.color_pair(17))

def draw_block(stdscr, x, y, n, speed):
    for l in range(0, 3):
        if n == speed:
            content = CONTENT % ((str(n + 1).rjust(2, "0")) if l == 1 else "  ")
        else:
            content = CONTENT % "  "

        color = curses.color_pair(18 if n > speed else (n + 1))

        stdscr.addstr(y + l,
                      x + (n * len(CONTENT)),
                      content,
                      color)

def visualize(stdscr, x, y, speed):
    stdscr.clear()

    for n in range(0, MAX_SPEED + 1):
        draw_block(stdscr, x, y, n, speed)

def main(stdscr):
    init_gradient()
    set_background(stdscr)

    curses.curs_set(0)
    curses.init_pair(18, 0, 246)

    stdscr.clear()

    x = int(curses.COLS / 2) - (int(len(CONTENT)) * 8)
    y = int(curses.LINES / 2) - 1
    state = {
        "started": False,
        "speed": 0,
        "lanechange": False,
    }

    visualize(stdscr, x, y, state["speed"])

    while True:
        ch = stdscr.getch()

        if ch == 113: # q
            break
        elif ch == curses.KEY_UP and state["speed"] < MAX_SPEED:
            state["speed"] += 1
        elif ch == curses.KEY_DOWN and state["speed"] > 0:
            state["speed"] -= 1
        elif ch > 48 and ch < 58: # 1 - 9
            state["speed"] = ch - 49
        elif ch > 96 and ch < 103: # a - f
            state["speed"] = ch - 87
        elif ch == 48: # 0
            state["speed"] = 9

        visualize(stdscr, x, y, state["speed"])

curses.wrapper(main)
